---
title: "Project 1"
author: "Julia Martin"
date: "9/9/2024"
output: html_document
---

## Download Necessary Packages  

```{r}
library(tidyverse)
if (!require("tidytuesdayR", quietly = TRUE)) {
    install.packages("tidytuesdayR")
}
if (!require("remotes", quietly = TRUE)) {
    install.packages("remotes")
}
if (!require("tidytuesdayR", quietly = TRUE)) {
    remotes::install_github("dslc-io/tidytuesdayR")
}

library("here")
library("tidyverse")
```

## Read in chocolate data  

```{r}
# tests if a directory named "data" exists locally
if (!dir.exists(here("data"))) {
    dir.create(here("data"))
}

# saves data only once (not each time you knit a R Markdown)
if (!file.exists(here("data", "chocolate.RDS"))) {
    url_csv <- "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-18/chocolate.csv"
    chocolate <- readr::read_csv(url_csv)

    # save the file to RDS objects
    saveRDS(chocolate, file = here("data", "chocolate.RDS"))
}
chocolate <- readRDS(here("data", "chocolate.RDS"))
as_tibble(chocolate)
glimpse(chocolate)
```

## Part 1  

### 1  
```{r}
library(ggplot2)
library(gridExtra)
bin_default <- ggplot(chocolate, aes(x=rating)) + geom_histogram() + ggtitle("Default Bins")
bins_10 <- ggplot(chocolate, aes(x=rating)) + geom_histogram(bins=10) + ggtitle("Bins = 10")
bins_15 <- ggplot(chocolate, aes(x=rating)) + geom_histogram(bins=15) + ggtitle("Bins = 15")
bins_20 <- ggplot(chocolate, aes(x=rating)) + geom_histogram(bins=20) + ggtitle("Bins = 20")
bins_25 <- ggplot(chocolate, aes(x=rating)) + geom_histogram(bins=25) + ggtitle("Bins = 25")
grid.arrange(bin_default, bins_10, bins_15, bins_20, bins_25, ncol=2)
```
When I change the number of bins to be greater, we can see a more precise distribution of the ratings compared to when the number of bins is less. I think 15 bins looks the best because the bins are not too wide that they prevent specific trends in the ratings from being shown, but wide enough that there are not too many spaces between the columns.  

### 2  

```{r}
chocolate %>% 
  group_by(country_of_bean_origin) %>% 
   summarise(Freq = length(rating))
```
### 3

```{r}
chocolate %>% 
  filter(country_of_bean_origin=="Ecuador") %>% 
    summarize(mean_rating = mean(rating), sd_rating = sd(rating), total=length(rating))
```

### 4

```{r}
chocolate %>% 
  filter(country_of_bean_origin=="Ecuador") %>% 
  group_by(company_location) %>% 
  summarize(avg_rating = mean(rating)) %>% 
  arrange(desc(avg_rating))
```
Australia makes the best chocolate with beans from Ecuador.  

### 5 

```{r}
chocolate %>% 
  group_by(country_of_bean_origin) %>% 
  summarize(avg_rating = mean(rating)) %>% 
  arrange(desc(avg_rating)) %>% 
  slice(1:3)
```
Tobago, China, and Sao Tome & Principe have the highest average ratings.  

### 6

```{r}
country_greater_10 <- chocolate %>% 
  group_by(country_of_bean_origin) %>% 
  summarise(Freq = length(rating)) %>% 
  filter(!Freq<10)

chocolate %>% 
  filter(country_of_bean_origin %in% country_greater_10$country_of_bean_origin) %>% 
  group_by(country_of_bean_origin) %>% 
  summarize(avg_rating = mean(rating)) %>% 
  arrange(desc(avg_rating)) %>% 
  slice(1:3)
```

Now, the top 3 countries with the highest average ratings are Solomon Islands, Congo, and Cuba

### 7

```{r}
country_greater_50 <- chocolate %>% 
  group_by(country_of_bean_origin) %>% 
  summarise(Freq = length(rating)) %>% 
  filter(!Freq<50)

chocolate_percent_levels <- chocolate %>% 
  filter(country_of_bean_origin %in% country_greater_50$country_of_bean_origin) %>% 
  mutate(percent_group = as.factor(case_when(
    as.numeric(substr(cocoa_percent, 1,2)) < 60 ~ "<60%",
    as.numeric(substr(cocoa_percent, 1,2)) >= 60 & as.numeric(substr(cocoa_percent, 1,2)) < 70 ~ ">=60 to 70%",
    as.numeric(substr(cocoa_percent, 1,2)) >= 70 & as.numeric(substr(cocoa_percent, 1,2)) < 90 ~ ">=70 to 90%",
    as.numeric(substr(cocoa_percent, 1,2)) >= 90 ~ ">=90%"
         )))

levels(chocolate_percent_levels$percent_group)

ggplot(chocolate_percent_levels, aes(percent_group,rating)) +
  geom_boxplot() +
  facet_wrap(~chocolate_percent_levels$country_of_bean_origin) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) + xlab("Chocolate Percentage") + ylab("Rating") + ggtitle("Ratings by Chocolate Percentage Groups for Countries with > 50 Reviews")
```
It seems that the 60-70% range has the highest ratings, but in a few countries, the 70-90% range ranks the highest.  

## Part 2 

```{r}
install.packages("gapminder")
library(gapminder)
gapminder_unique <- gapminder %>% 
  distinct(country,.keep_all = T)

joint_frame <- left_join(chocolate,gapminder_unique[,1:2],by=c("country_of_bean_origin"="country"))
filtered <- joint_frame %>% 
  filter(is.na(continent)) 
unique(filtered$country_of_bean_origin) %in% gapminder$country
gapminder[gapminder$country=="Congo",]

unique(gapminder$continent)
Americas <- c("Belize","Grenada","Martinique", "St. Lucia", "U.S.A", "St.Vincent-Grenadines", "Tobago", "Suriname")
Oceania <- c("Fiji","Papua New Guinea","Vanuatu", "Solomon Islands", "Samoa", )
Asia <- c("Burma", "Sumatra", "Sulawesi")
Africa <- c("Sao Tome","Congo","Ivory Coast", "Sao Tome & Principe", "Principe", "DR Congo")


```

