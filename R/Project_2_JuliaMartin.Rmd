---
title: "Project_2_JuliaMartin"
output: html_document
date: "2024-09-24"
---

### Call necessary packages

```{r}
library(tidyverse)
library(tidytuesdayR)
library(usethis)
library(here)
library(lubridate)
```

## Part 1

### Part 1A: Exponential transformation

```{r}
Exp <- function(x, k) {
    series <- rep(NA,k+1)
    for(i in 0:k) {
      series[i+1] <- (x^i) / factorial(i)
    }
    sum(series)
}
```

### Part 1B: Sample mean and sample standard deviation

```{r}
sample_mean <- function(x) {
    sum(x) / length(x)
}

sample_sd <- function(x) {
    xbar <- sum(x) / length(x)
    sqrt(sum((x - xbar)^2) / (length(x)-1))
}
```

### Part 1C: Confidence intervals 

```{r}
calculate_CI <- function(x, conf = 0.95) {
  N <- length(x)
  alpha <- 1 - conf
  degrees_freedom <- N - 1
  t_score <- qt(p = alpha / 2, df = degrees_freedom, lower.tail = FALSE)
  xbar <- sample_mean(x)
  s_xbar <- sample_sd(x) / sqrt(N)
  CI <- c(xbar-(t_score*s_xbar), xbar+(t_score*s_xbar))
  CI
}

# test the function with the confint() function with two different confidence levels:

# vector x
x <- c(5,7,1,2,5,0,8,7,6,5,3,3,4)
dat <- data.frame(x = x)
fit <- lm(x ~ 1, dat)

# Calculate a 95% confidence interval
confint(fit, level = 0.95)
calculate_CI(x, 0.95)

# Calculate a 90% confidence interval
confint(fit, level = 0.9)
calculate_CI(x, 0.9)

# For both a confidence level of 90% and 95%, my function matches the output of the confint function
```

## Part 2 

Load data  

```{r}
rainfall <- readRDS(here("data", "tuesdata_rainfall.RDS"))
temperature <- readRDS(here("data", "tuesdata_temperature.RDS"))
glimpse(rainfall)
glimpse(temperature)
```

Tasks  

```{r}
df <- rainfall %>% 
  drop_na() %>% 
  mutate(date=ymd(paste(year, month, day, sep = "-"))) %>% 
  select (-c(month,day)) %>% 
  mutate(city_name=str_to_upper(city_name))

df <- inner_join(df, temperature, by = c("city_name"="city_name", "date"="date"), relationship = "many-to-many")
dim(df)
head(df,10)
```
## Part 3  

### Part 3A: Plotting Temperature Data Over Time

```{r}
temp_plot <- df %>% 
  filter(year >= 2014)

ggplot(temp_plot, aes(date, temperature, group = temp_type, color = temp_type)) +
  geom_line() +
  facet_wrap(~city_name) + 
  guides(color = guide_legend(title = "Temperature Type")) + scale_color_manual(labels = c("Maximum", "Minimum"), values = c("red1","blue4")) + ggtitle("Maximum and Minimum Temperatures in 5 Australian Cites from 2014-2019") + ylab("Temperature (degrees Celcius)") + xlab("Year") + labs(subtitle = str_wrap("Minimum temperatures have remained roughly stable, but Sydney is seeing a slight rise in maximum temperatures during the Summer months and Melbourne and Perth are seeing a slight decrease in maximum temperatures during the Summer"), caption = "Made by Julia Martin") + theme(legend.position = "bottom", title = element_text(family = "Optima"))
```

### Part 3B: Plotting Rainfall Over Time  

I chose to design my function by first determining if the inputs are valid. If the given city and year do not appear in the dataset, an error messaged is produce letting the user know. I chose to do this at the beginning of the function because there is no use trying to filter a dataset into certain values that the variables do not take. Then, I use the inputted city and year to filter the dataset to the desired inputs and saved it as a new data farme so that it can be used in the plot function. Next, I created a histogram using the the newly created data frame. 

```{r}
rainfall_hist <- function(city_input, year_input) {
  if(!(city_input %in% df$city_name) | !(year_input %in% df[df$city_name==city_input,]$year)) {
    stop("Error: input does not exist in the dataset")
  }
  hist_data <- df %>% 
    filter(city_name == city_input, year == year_input)
  title <- paste("Distribution of Rainfall in", str_to_title(eval(city_input)), "in", eval(year_input),sep = " ")
  ggplot(hist_data, aes(log(rainfall))) +
    geom_histogram(fill="lightblue2",bins=25) + ylab("Frequency") + xlab("Log of Rainfall (in mm)") +      ggtitle(title) + labs(subtitle = "Histogram of rainfall patterns using a logarithmic scale", caption = "Made by Julia Martin")
}

rainfall_hist("PERTH", 2014)
rainfall_hist("SYDNEY", 1984)
# rainfall_hist("CANBERRA", 1990) # example of an invalid input
```
## Part 4 Apply Functions and Plot  

### Part 4A

```{r}
rain_df <- df %>% 
  filter(year >= 2014) %>% 
  group_by(city_name, year) %>% 
  summarize(sample_mean = sample_mean(rainfall), sample_sd = sample_sd(rainfall), lower_bound = calculate_CI(rainfall, 0.95)[1], upper_bound = calculate_CI(rainfall,0.95)[2])

head(rain_df, n= 10)
```

### Part 4B  

```{r}
ggplot(rain_df, aes(year, sample_mean, color=city_name)) +
  geom_point() + 
  geom_line() + 
  geom_errorbar(aes(ymin = lower_bound, ymax = upper_bound), width = 0.2) + 
  facet_wrap(~city_name) + ggtitle("Rainfall Trends in 5 Australian Cities from 2014-2019")+ theme(legend.position = "bottom", title = element_text(family = "Optima"), axis.text.x = element_text(family = "Optima"), axis.text.y = element_text(family = "Optima"), legend.text = element_text(family = "Optima"), strip.text.x = element_text(family = "Optima"))  +
  ylab("Average Daily Rainfall (mm)") + xlab("Year") + 
  guides(color = guide_legend(title = "City Name")) + labs(subtitle = str_wrap("Average rainfall has decreased in Brisbane beginning in 2016 and in Perth beginning in 2019, while it has remained relatively stable in Canberra, Melbourne, and Sydney", width = 100), caption = "Made by Julia Martin") 
```




df[df$city_name=="CANBERRA",]
canberra -- 2008-2012
sydney -- 1910 ---
perth -- 1967 --
  brisbane -- 1965
melbourne 1964
